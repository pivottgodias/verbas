<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de Dossiê</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .item-container { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background-color: #f0f0f0; text-transform: uppercase; }
  </style>
</head>
<body>

  <h1>Cadastro de Verba</h1>

  <label for="tipoVerba">Tipo de Verba:</label>
  <select id="tipoVerba">
    <option value="SELL IN">SELL IN</option>
    <option value="SELL OUT">SELL OUT</option>
    <option value="MERCHANDISING">MERCHANDISING</option>
  </select>

  <div id="camposComuns">
    <input type="text" placeholder="Família" id="familia" />
    <input type="text" placeholder="Produto" id="produto" />
    <input type="number" placeholder="Unidades" id="unidades" />
    <input type="text" placeholder="Verba" id="verba" />
    <input type="text" placeholder="Bonificação" id="bonificacao" />
    <input type="text" placeholder="TTC" id="ttc" />
    <input type="text" placeholder="TTV" id="ttv" />
  </div>

  <button onclick="addItem()">Adicionar Item</button>

  <div id="SELL IN" class="item-container">
    <h3>Itens SELL IN</h3>
    <table><thead><tr><th>Família</th><th>Produto</th><th>Unidades</th><th>Verba</th><th>Bonificação</th><th>TTC</th><th>TTV</th></tr></thead><tbody></tbody></table>
  </div>

  <div id="SELL OUT" class="item-container">
    <h3>Itens SELL OUT</h3>
    <table><thead><tr><th>Família</th><th>Produto</th><th>Unidades</th><th>Verba</th><th>Bonificação</th><th>TTC</th><th>TTV</th></tr></thead><tbody></tbody></table>
  </div>

  <div id="MERCHANDISING" class="item-container">
    <h3>Itens MERCHANDISING</h3>
    <table><thead><tr><th>Família</th><th>Produto</th><th>Unidades</th><th>Verba</th><th>Bonificação</th><th>TTC</th><th>TTV</th></tr></thead><tbody></tbody></table>
  </div>

  <button onclick="generatePDF()">Gerar Dossiê PDF</button>

  <script>
    function addItem() {
      const tipo = document.getElementById("tipoVerba").value;
      const familia = document.getElementById("familia").value;
      const produto = document.getElementById("produto").value;
      const unidades = document.getElementById("unidades").value;
      const verba = document.getElementById("verba").value;
      const bonificacao = document.getElementById("bonificacao").value;
      const ttc = document.getElementById("ttc").value;
      const ttv = document.getElementById("ttv").value;

      const tableBody = document.querySelector(`#${tipo} tbody`);
      const row = document.createElement("tr");

      [familia, produto, unidades, verba, bonificacao, ttc, ttv].forEach(value => {
        const td = document.createElement("td");
        td.textContent = value;
        row.appendChild(td);
      });

      tableBody.appendChild(row);

      // Limpar campos
      document.getElementById("familia").value = "";
      document.getElementById("produto").value = "";
      document.getElementById("unidades").value = "";
      document.getElementById("verba").value = "";
      document.getElementById("bonificacao").value = "";
      document.getElementById("ttc").value = "";
      document.getElementById("ttv").value = "";
    }

    function collectItems() {
      const tipos = ["SELL IN", "SELL OUT", "MERCHANDISING"];
      const data = {};

      tipos.forEach(tipo => {
        const rows = document.querySelectorAll(`#${tipo} tbody tr`);
        if (rows.length > 0) {
          data[tipo] = Array.from(rows).map(row => {
            return Array.from(row.children).map(td => td.textContent);
          });
        }
      });

      return data;
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("DOSSIÊ DE VERBAS", 14, 15);
      doc.setFontSize(10);
      doc.text(`Data: ${new Date().toLocaleDateString()}`, 14, 22);

      const items = collectItems();
      let y = 30;

      Object.entries(items).forEach(([tipo, dados]) => {
        doc.setFontSize(12);
        doc.text(`${tipo}`, 14, y);
        y += 5;
        doc.autoTable({
          startY: y,
          head: [["FAMÍLIA", "PRODUTO", "UNIDADES", "VERBA", "BONIFICAÇÃO", "TTC", "TTV"]],
          body: dados,
          theme: 'grid',
          styles: { fontSize: 9 },
          headStyles: { fillColor: [200, 200, 200] }
        });
        y = doc.lastAutoTable.finalY + 10;
      });

      doc.save("dossie_verbas.pdf");
    }
  </script>
</body>
</html>
